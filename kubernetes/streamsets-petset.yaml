# https://github.com/Yolean/kubernetes-kafka/blob/master/50kafka.yml
apiVersion: v1
kind: Namespace
metadata:
  name: streamsets
---
apiVersion: apps/v1alpha1
kind: PetSet
metadata:
  name: streamsets
  namespace: streamsets
spec:
  serviceName: "streamsets"
  replicas: 1
  template:
    metadata:
      labels:
        app: streamsets 
      annotations:
        pod.alpha.kubernetes.io/initialized: "true"
        pod.alpha.kubernetes.io/init-containers: '[
        ]'
    spec:
      containers:
      - name: streamsets
        image: ifire/datacollector
        ports:
        - containerPort: 18630       
        command:
          - "/bin/bash"
          - "-ecx"
          - |         
            exec /bin/bash -c " mkdir -p /data && cd /opt/streamsets-datacollector-2.2.0.0 && mkdir -p libs-common-lib/streamsets-datacollector-jdbc-lib/lib && curl -sL https://github.com/SnappyDataInc/snappydata/releases/download/v0.6.1/snappydata-client-1.5.2.jar > libs-common-lib/streamsets-datacollector-jdbc-lib/lib/snappydata-client-1.5.2.jar && ADD_LIBS=streamsets-datacollector-jdbc-lib,streamsets-datacollector-apache-kafka_0_10-lib,streamsets-datacollector-aws-lib /docker-entrypoint.sh dc -exec" 
        volumeMounts:
        - name: datadir
          mountPath: /sdc
  volumeClaimTemplates:
  - metadata:
      name: datadir
      namespace: streamsets
      annotations:
        volume.alpha.kubernetes.io/storage-class: anything
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 1000Mi

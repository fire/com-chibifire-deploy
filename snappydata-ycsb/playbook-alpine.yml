- hosts: all
  vars:
  tasks:
    - name: upgrade all packages
      apk: upgrade=yes
    - name: install openjdk 1.8
      apk: name=openjdk8 state=latest
    - name: install bash
      apk: name=bash state=latest
    - name: install busybox-suid
      apk: name=busybox-suid state=latest 
    - name: install shadow package
      shell: apk add 'shadow' --update-cache --repository https://nl.alpinelinux.org/alpine/edge/community
    - name: remove root password
      shell: passwd -d root
    - name: add snappydata group 
      group: name=snappydata state=present
    - name: create snappydata directory
      file: path=/opt/snappydata state=directory
    - name: create snappydata user
      user: name=snappydata group=snappydata comment="SnappyData" home=/opt/snappydata shell=/bin/bash system=true
    - name: change snappydata directory ownership
      file: path=/opt/snappydata state=directory owner=snappydata group=snappydata
    - name: install tar package
      apk: name=git state=latest
    - name: install maven
      shell: apk add maven --update-cache --repository http://dl-3.alpinelinux.org/alpine/edge/community
    - name: clone git repo
      git:
        repo: https://github.com/fire/YCSB.git
        dest: /opt/snappydata/YCSB
        version: ycsb-kube
      become: yes
      become_user: snappydata  
    - name: build ycsb once
      shell: cd /opt/snappydata/YCSB && mvn -pl com.yahoo.ycsb:snappystore-binding -am package -DskipTests dependency:build-classpath -DincludeScope=compile -Dmdep.outputFilterFile=true
      become: yes
      become_user: snappydata  
  handlers:
